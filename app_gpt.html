<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Bo√Æte aux Questions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;display:flex;justify-content:center;align-items:center;
            padding:20px;color:white;overflow-x:hidden;
        }
        @keyframes gradientBG {0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
        .container {width:100%;max-width:900px;background:rgba(0,0,0,0.7);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.5);overflow:hidden;position:relative;}
        .page {padding:40px;display:flex;flex-direction:column;align-items:center;min-height:600px;}
        h1 {font-size:2.5rem;margin-bottom:20px;text-align:center;text-shadow:0 2px 4px rgba(0,0,0,0.5);}
        h2 {font-size:1.8rem;margin-bottom:30px;text-align:center;color:#ffcc00;}
        button {
            background:#ffcc00;color:#1a2a6c;border:none;padding:15px 40px;font-size:1.2rem;font-weight:bold;
            border-radius:50px;cursor:pointer;transition:all .3s ease;margin-top:20px;box-shadow:0 4px 10px rgba(0,0,0,0.3);
        }
        button:hover {background:#ffdd55;transform:translateY(-3px);}
        button:disabled {background:#666;cursor:not-allowed;opacity:.7;}
        .recording-indicator {display:flex;align-items:center;margin-bottom:20px;background:rgba(255,0,0,0.2);padding:10px 20px;border-radius:30px;}
        .recording-dot {width:15px;height:15px;background:red;border-radius:50%;margin-right:10px;animation:pulse 1.5s infinite;}
        @keyframes pulse {0%{opacity:1;}50%{opacity:.3;}100%{opacity:1;}}
        .question-container {background:rgba(255,255,255,0.1);border-radius:20px;padding:30px;margin:30px 0 20px;width:100%;min-height:180px;display:flex;align-items:center;justify-content:center;position:relative;}
        .question-text {font-size:1.6rem;text-align:center;font-weight:bold;animation:fadeIn .5s ease-out;padding:10px;}
        @keyframes fadeIn {from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
        .question-counter {position:absolute;top:15px;right:15px;background:rgba(0,0,0,0.5);padding:5px 15px;border-radius:20px;font-size:.9rem;}
        .progress-bar {width:100%;height:10px;background:rgba(255,255,255,0.1);border-radius:5px;margin:20px 0;overflow:hidden;}
        .progress {height:100%;background:linear-gradient(90deg,#ffcc00,#ff9900);border-radius:5px;width:0%;transition:width .5s ease;}
        .webcam-container {width:100%;max-width:600px;margin:20px auto;background:rgba(0,0,0,0.3);border-radius:10px;padding:20px;text-align:center;}
        #webcamPreview {width:100%;max-width:500px;border-radius:10px;background:#000;transform:scaleX(-1);}
        .controls {display:flex;justify-content:center;margin-top:20px;}
        .end-animation {background:#ff6b6b;color:white;padding:20px 40px;font-size:1.5rem;animation:pulseBig 2s infinite;}
        @keyframes pulseBig {0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);}}
        .instructions {background:rgba(255,255,255,0.1);border-radius:15px;padding:20px;margin-top:20px;max-width:700px;}
        .instructions li {margin-bottom:10px;text-align:left;}
        .video-container {width:100%;max-width:600px;margin:20px auto;background:rgba(0,0,0,0.3);border-radius:10px;padding:20px;text-align:center;}
        #recordedVideo {width:100%;max-width:500px;border-radius:10px;background:#000;}
    </style>
</head>
<body>
<div class="container">
    <!-- Page d'accueil -->
    <div id="landingPage" class="page">
        <h1><i class="fas fa-box"></i> La Bo√Æte aux Questions</h1>
        <h2>Bienvenue au d√©fi des moumounes</h2>

        <div class="permission-section">
            <p>Pour participer au jeu, nous avons besoin d'acc√©der √† votre cam√©ra et micro.</p>
            <button id="permissionBtn"><i class="fas fa-check-circle"></i> Autoriser cam√©ra & micro</button>
        </div>

        <button id="startBtn" disabled>
            <i class="fas fa-play"></i> Lancer le Jeu
        </button>

        <div class="instructions">
            <p><i class="fas fa-info-circle"></i> R√®gles :</p>
            <ul>
                <li>Par groupe de 1 √† 5 personnes max</li>
                <li>R√©pondez aux questions sur les moumounes, film√© et enregistr√©</li>
                <li>Une personne lit la question √† haute voix avant de r√©pondre</li>
                <li>Vous avez un temps d√©fini par question avant de passer automatiquement √† la suivante</li>
                <li>R√©pondez seul ou en groupe, √† vous de choisir !</li>
                <li><b>Nous serons les seuls √† voir la vid√©o (montage ensuite possible)</b></li>
            </ul>
        </div>
    </div>

    <!-- Page de quiz -->
    <div id="recordingPage" class="page hidden">
        <div class="recording-indicator">
            <div class="recording-dot"></div><span>Enregistrement en cours...</span>
        </div>

        <div class="question-container">
            <div class="question-counter">Question <span id="currentQuestion">1</span>/<span id="totalQuestions">1</span></div>
            <div class="question-text" id="questionText">Chargement des questions...</div>
        </div>

        <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
        </div>

        <div class="webcam-container">
            <video id="webcamPreview" autoplay muted playsinline></video>
        </div>

        <div class="controls">
            <button id="endBtn" class="hidden end-animation"><i class="fas fa-stop"></i> Terminer</button>
        </div>
    </div>

    <!-- Page de fin -->
    <div id="endPage" class="page hidden">
        <h1><i class="fas fa-trophy"></i> Jeu Termin√©!</h1>
        <h2>Merci pour vos r√©ponses ‚ù§Ô∏è</h2>
        <div class="video-container">
            <h3><i class="fas fa-film"></i> Votre enregistrement</h3>
            <video id="recordedVideo" controls></video>
        </div>
        <button id="downloadBtn"><i class="fas fa-download"></i> T√©l√©charger la Vid√©o</button>
        <button id="restartBtn"><i class="fas fa-redo"></i> Rejouer</button>
    </div>
</div>

<script>
const questions = [
    "On commence facile : quel est l‚Äô√¢ge de Margaux et de Corentin ?",
    "Qui a fait le premier pas entre Margaux et Corentin selon vous ?",
    "Match de Bi√®re pong Corentin VS Margaux, qui gagne ?",
    "Qui fait le mieux la cuisine ?",
    "Y‚Äôa t-il un plus beau couple que les moumounes dans ce mariage ? (Si oui nommez le ! Une seule r√©ponse accord√©e)",
    "Donnez une musique qui vous rappelle un souvenir avec les moumounes (et le contexte)",
    "Racontez une anecdote dr√¥le sur Corentin ou Margaux (ou les deux !)",
    "En combien de temps les moumounes ont mont√© le col du Tourmalet ?",
    "Pensez-vous que les moumounes peuvent lancer leur cha√Æne YouTube ?",
    "Pensez-vous voir appara√Ætre Spider Bar ce soir ?",
    "Bonus : Qui porte la culotte ? (justifiez votre r√©ponse... ou pas üòÜ)"
];

// Dur√©e sp√©cifique (ms) pour chaque question
const questionDurations = [
    8000,  // Q1 : 8s
    8000,  // Q2
    8000,  // Q3
    8000,  // Q4
    12000, // Q5
    15000, // Q6
    15000, // Q7
    10000, // Q8
    8000,  // Q9
    8000,  // Q10
    12000  // Bonus
];

const landingPage=document.getElementById('landingPage');
const recordingPage=document.getElementById('recordingPage');
const endPage=document.getElementById('endPage');
const startBtn=document.getElementById('startBtn');
const endBtn=document.getElementById('endBtn');
const downloadBtn=document.getElementById('downloadBtn');
const restartBtn=document.getElementById('restartBtn');
const questionText=document.getElementById('questionText');
const currentQuestionEl=document.getElementById('currentQuestion');
const totalQuestionsEl=document.getElementById('totalQuestions');
const progressBar=document.getElementById('progressBar');
const recordedVideo=document.getElementById('recordedVideo');
const webcamPreview=document.getElementById('webcamPreview');
const permissionBtn=document.getElementById('permissionBtn');

let currentQuestionIndex=0, mediaRecorder, recordedChunks=[], stream=null, questionTimer=null;
totalQuestionsEl.textContent=questions.length;

// Permissions cam√©ra/micro
permissionBtn.addEventListener('click',async()=>{
    try{
        stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
        startBtn.disabled=false;
        alert("Acc√®s accord√© ‚úÖ");
    }catch(err){alert("Erreur : acc√®s refus√© üö´");}
});

startBtn.addEventListener('click',startQuiz);
endBtn.addEventListener('click',finishQuiz);
downloadBtn.addEventListener('click',downloadVideo);
restartBtn.addEventListener('click',()=>window.location.reload());

async function startQuiz(){
    landingPage.classList.add('hidden');
    recordingPage.classList.remove('hidden');
    webcamPreview.srcObject=stream;
    recordedChunks=[];
    mediaRecorder=new MediaRecorder(stream,{mimeType:'video/webm;codecs=vp9,opus'});
    mediaRecorder.ondataavailable=e=>{if(e.data.size>0)recordedChunks.push(e.data);};
    mediaRecorder.start(100);
    showQuestion(currentQuestionIndex);
}

function showQuestion(index){
    if(index<questions.length){
        questionText.textContent=questions[index];
        currentQuestionEl.textContent=index+1;
        progressBar.style.width=`${((index+1)/questions.length)*100}%`;
        clearTimeout(questionTimer);
        if(index<questions.length-1){
            questionTimer=setTimeout(()=>{
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            },questionDurations[index]||10000);
        }else{
            endBtn.classList.remove('hidden');
        }
    }
}

function finishQuiz(){
    if(mediaRecorder&&mediaRecorder.state!=="inactive")mediaRecorder.stop();
    recordingPage.classList.add('hidden');
    endPage.classList.remove('hidden');
    setTimeout(()=>{
        const blob=new Blob(recordedChunks,{type:'video/webm'});
        recordedVideo.src=URL.createObjectURL(blob);
    },500);
}

function downloadVideo(){
    if(recordedChunks.length===0){alert("Aucune vid√©o");return;}
    const blob=new Blob(recordedChunks,{type:'video/webm'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;a.download="moumounes-quiz.webm";a.click();
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
