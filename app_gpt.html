<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>La Bo√Æte aux Questions</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      margin:0;padding:0;display:flex;justify-content:center;align-items:center;
      min-height:100vh;background:linear-gradient(135deg,#1a2a6c,#b21f1f,#1a2a6c);
      background-size:400% 400%;animation:gradientBG 15s ease infinite;color:white;
      font-family:'Segoe UI',sans-serif;text-align:center;
    }
    @keyframes gradientBG {
      0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}
    }
    .page {display:none;max-width:800px;background:rgba(0,0,0,0.7);padding:30px;border-radius:20px;}
    .page.active {display:block;}
    h1 {font-size:2.2rem;margin-bottom:20px;}
    h2 {color:#ffcc00;margin-bottom:20px;}
    ul {text-align:left;}
    button {
      margin-top:20px;padding:15px 40px;border:none;border-radius:50px;
      background:#ffcc00;color:#1a2a6c;font-weight:bold;font-size:1.2rem;cursor:pointer;
    }
    .question-container {
      background:rgba(255,255,255,0.1);padding:30px;border-radius:20px;margin-bottom:20px;
    }
    .question-text {font-size:1.4rem;font-weight:bold;margin-bottom:15px;}
    .countdown {font-size:1.2rem;margin-top:10px;color:#ffcc00;}
    .progress-bar {height:10px;background:rgba(255,255,255,0.2);border-radius:5px;margin-top:20px;}
    .progress {height:100%;background:linear-gradient(90deg,#ffcc00,#ff9900);width:0%;}
  </style>
</head>
<body>
  <div id="rulesPage" class="page active">
    <h1><i class="fas fa-box"></i> La Bo√Æte aux Questions</h1>
    <h2>Bienvenue au d√©fi des moumounes üéâ</h2>
    <p><b>R√®gles :</b></p>
    <ul>
      <li>Par groupe de 1 √† 5 personnes max</li>
      <li>R√©pondez aux questions sur les moumounes, film√© et enregistr√©</li>
      <li>Une personne lit la question √† haute voix avant de r√©pondre</li>
      <li>Vous avez un temps d√©fini par question avant de passer automatiquement √† la suivante</li>
      <li>R√©pondez seul ou en groupe, √† vous de choisir</li>
      <li><b>Nous serons les seuls √† voir la vid√©o (montage ensuite possible)</b></li>
    </ul>
    <button id="permissionBtn"><i class="fas fa-check-circle"></i> Autoriser cam√©ra & micro</button><br>
    <button id="startBtn" disabled><i class="fas fa-play"></i> Commencer le Quiz</button>
  </div>

  <div id="quizPage" class="page">
    <div class="question-container">
      <div class="question-text" id="questionText">Chargement...</div>
      <div class="countdown" id="countdown">‚è≥ --s restantes</div>
    </div>
    <div class="progress-bar"><div class="progress" id="progress"></div></div>
    <video id="webcamPreview" autoplay muted playsinline style="margin-top:20px;width:100%;max-width:500px;border-radius:10px;transform:scaleX(-1)"></video>
  </div>

  <div id="endPage" class="page">
    <h1>üé¨ Quiz termin√© üé¨</h1>
    <p>Merci pour votre participation ‚ù§Ô∏è</p>
  </div>

<script>
const questions = [
  "On commence facile : quel est l‚Äô√¢ge de Margaux et de Corentin ?",
  "Qui a fait le premier pas entre Margaux et Corentin selon vous ?",
  "Match de Bi√®re pong Corentin VS Margaux, qui gagne ?",
  "Qui fait le mieux la cuisine ?",
  "Y‚Äôa t-il un plus beau couple que les moumounes dans ce mariage ? (Si oui nommez le ! Une seule r√©ponse accord√©e)",
  "Donnez une musique qui vous rappelle un souvenir avec les moumounes (et le contexte)",
  "Racontez une anecdote dr√¥le sur Corentin ou Margaux (ou les deux !)",
  "En combien de temps les moumounes ont mont√© le col du Tourmalet ?",
  "Pensez-vous que les moumounes peuvent lancer leur cha√Æne YouTube ?",
  "Pensez-vous voir appara√Ætre Spider Bar ce soir ?",
  "Bonus : Qui porte la culotte ? (justifiez votre r√©ponse... ou pas üòÜ)"
];

// Dur√©es sp√©cifiques en ms
const questionDurations = [8000,8000,8000,8000,12000,15000,15000,10000,8000,8000,12000];

const rulesPage=document.getElementById('rulesPage');
const quizPage=document.getElementById('quizPage');
const endPage=document.getElementById('endPage');
const questionText=document.getElementById('questionText');
const countdown=document.getElementById('countdown');
const progress=document.getElementById('progress');
const startBtn=document.getElementById('startBtn');
const permissionBtn=document.getElementById('permissionBtn');
const webcamPreview=document.getElementById('webcamPreview');

let stream=null,mediaRecorder,recordedChunks=[],currentQuestion=0,questionTimer;

permissionBtn.addEventListener('click',async()=>{
  try{
    stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
    webcamPreview.srcObject=stream;
    startBtn.disabled=false;
    alert("Cam√©ra & micro autoris√©s ‚úÖ");
  }catch(e){alert("Impossible d'acc√©der √† la cam√©ra/micro üö´");}
});

startBtn.addEventListener('click',()=>{
  rulesPage.classList.remove('active');
  quizPage.classList.add('active');
  startRecording();
  showQuestion(0);
});

function startRecording(){
  recordedChunks=[];
  mediaRecorder=new MediaRecorder(stream,{mimeType:'video/webm;codecs=vp9,opus'});
  mediaRecorder.ondataavailable=e=>{if(e.data.size>0)recordedChunks.push(e.data);}
  mediaRecorder.start(100);
}

function showQuestion(index){
  if(index>=questions.length){finishQuiz();return;}
  questionText.textContent=questions[index];
  let duration=questionDurations[index]||10000;
  let remaining=Math.ceil(duration/1000);
  countdown.textContent=`‚è≥ ${remaining}s restantes`;
  progress.style.width="0%";

  let elapsed=0;
  clearInterval(questionTimer);
  questionTimer=setInterval(()=>{
    elapsed+=100;
    if(elapsed%1000===0){
      remaining--;
      countdown.textContent=`‚è≥ ${remaining}s restantes`;
    }
    progress.style.width=Math.min((elapsed/duration)*100,100)+"%";
    if(elapsed>=duration){
      clearInterval(questionTimer);
      currentQuestion++;
      showQuestion(currentQuestion);
    }
  },100);
}

function finishQuiz(){
  mediaRecorder.stop();
  quizPage.classList.remove('active');
  endPage.classList.add('active');
  // T√©l√©chargement auto
  setTimeout(()=>{
    const blob=new Blob(recordedChunks,{type:'video/webm'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;a.download="moumounes-quiz.webm";a.click();
    URL.revokeObjectURL(url);
  },500);
}
</script>
</body>
</html>
